# Spectator Respawn Data Pack (Dynamic Team Registration & Spawn Marker Protection)

このデータパックは、プレイヤーが死亡した際に一旦スペクテイターモードとなり、一定時間後に  
チーム別に設定されたリスポーン地点へテレポートさせる機能を提供します。

また、スポーンマーカー（armor_stand）については以下の対策を行います。

- **耐久性対策:**  
  管理者が任意の位置でスポーンマーカーを召喚した場合、  
  ※データパック内の `spawn_marker_adjust` 関数を実行すると  
  そのスポーンマーカーは召喚位置から**500ブロック上**に移動します。  
  プレイヤーのリスポーン時は、このスポーンマーカーの位置からさらに**500ブロック下**にテレポートされ、  
  本来のリスポーン地点（管理者が指定した位置）として機能します。

- **重複削除:**  
  複数のスポーンマーカーが同一チーム用に存在している場合、  
  管理者は `/function spectator_respawn:spawn_marker_remove` を実行することで  
  すべてのスポーンマーカーを削除し、改めて新しいスポーンマーカーを召喚できます。


---

## インストール方法

1. このフォルダ（spectator_respawn）をワールドの `datapacks/` フォルダに配置してください。  
2. ゲーム内で `/reload` を実行し、データパックを読み込みます。

---

## 基本動作

1. **死亡時の処理**  
   対象プレイヤー（`spConfigured` タグが付与されたプレイヤー）は死亡すると、  
   内部の `isDead`（deathCount）により検知され、即座にスペクテイターモードへ切替わり、  
   `respawnTimer` が 100（約5秒）にセットされます。

2. **タイマー処理**  
   毎tick、`respawnTimer` が1ずつ減算されます。

3. **リスポーン処理**  
   タイマーが0になったプレイヤーは、  
   プレイヤーに設定された `teamID`（scoreboard dummy型）に応じたスポーンマーカーへテレポートし、  
   その位置から**500ブロック下**に移動してサバイバルモードに戻ります。  
   （例：teamID=1 の場合、スポーンマーカーは armor_stand にタグ `spawn_team_1` が付与され、  
   その位置から500ブロック下がリスポーン地点となります。）

4. **スポーンマーカーの調整**  
   - 管理者は、スポーンマーカーを召喚後、必ず  
     `/function spectator_respawn:spawn_marker_adjust`  
     を実行して、召喚位置から500ブロック上に移動させ、調整済みとしてマークします。  
   - すでに同一チーム用のスポーンマーカーが存在している場合は、  
     重複している可能性があるので、  
     `/function spectator_respawn:spawn_marker_remove` を実行して削除し、  
     改めて新しいスポーンマーカーを召喚してください。

---

## 管理者による動的チーム登録方法

1. **対象プレイヤーの登録**  
   - 任意のチーム（例：teamID=1）の対象プレイヤーに対し、  
     ```
     /scoreboard players set <player> teamID 1
     /tag <player> add spConfigured
     ```
     を実行してください。

2. **スポーンマーカーの召喚と調整**  
   - 例：teamID 1 のリスポーン地点として、  
     管理者は対象地点で以下のコマンドを実行してスポーンマーカーを召喚します。
     ```
     /summon armor_stand ~ ~ ~ {Tags:["spawn_marker","spawn_team_1"],Invisible:1b,Marker:1b,NoGravity:1b}
     ```
   - その後、必ず  
     ```
     /function spectator_respawn:spawn_marker_adjust
     ```
     を実行してください。これにより、召喚したスポーンマーカーが500ブロック上へ移動し、  
     調整済みとなります。

3. **スポーンマーカーの削除（重複対策）**  
   - 万が一、重複したスポーンマーカーが存在する場合は、  
     ```
     /function spectator_respawn:spawn_marker_remove
     ```
     を実行することで、全てのスポーンマーカーを削除できます。  
     ※ 必要なチームについては、削除後に再度スポーンマーカーの召喚と調整を行ってください。

---

## 更新履歴

- **初版:** 動的チーム登録と、スポーンマーカーの耐久性対策（500ブロック上/下仕様）、および重複削除機能を実装